#!/usr/bin/env ruby
# frozen_string_literal: true

# Sync models from Replicate API to local database
require_relative "../lib/config"
require_relative "../lib/db"

require_relative "../lib/api"

token = Repligen::Config.load
db = Repligen::Database.new

api = Repligen::API.new(token)

limit = (ARGV[0] || 1000).to_i
puts "Syncing up to #{limit} models from Replicate API..."
models = api.models(limit: limit)

models.each do |model_data|
  model = Repligen::Model.new(**model_data)

  db.save(model)

end

puts "âœ“ Synced #{models.size} models"
puts "Total in database: #{db.count}"

